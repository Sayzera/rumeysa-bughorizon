import React, { useEffect, useState } from 'react'
import axios from 'axios'
import { endpoints } from "../../constant/endpoints.js";
import { Grid, Paper, Typography, Box,IconButton} from '@mui/material';
import DeleteIcon from '@mui/icons-material/Delete';
import { use } from 'react';

function ListVulnerabilityScreen() {

  const [data,setData]=useState([])
  useEffect(()=>{
    fetchData();
  }, [])

  const fetchData=() => {
    axios.get(import.meta.env.VITE_BASE_URL + endpoints.listVulnerability)
    .then((res)=>{
      setData(res.data.data)
    })
    .catch((error) => {
      const err = error.response.data;
      alert(err.message)
    })
  };

  const handleClick = (id) => {
    axios
      .post(import.meta.env.VITE_BASE_URL + endpoints.deleteVulnerability,{
        id: id,
      })
      .then((res) => {
        alert(res.data.message);
        fetchData(); 
      })
      .catch((error) => {
        const err = error.response?.data;
        alert(err?.message || "Silme işlemi sırasında bir hata oluştu");
      });
  };


  return (
    <Box sx={{ display: 'flex', justifyContent: 'flex-start', alignItems: 'center', minHeight: '100vh', pl: 3 }}>
      <Grid container spacing={1} sx={{ width: '33%' }}>
        <Grid item xs={12}>
          {data.map((item) => (
            <Paper elevation={3} sx={{ p: 2, mb: 2, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }} key={item.id}>
              <Box>
                <Typography variant="h6" gutterBottom>
                  {item.zaafiyet_adi}
                </Typography>
                <Typography variant="body2" color="textSecondary">
                  {item.zaafiyet_aciklamasi}
                </Typography>
              </Box>
              <IconButton color="error" onClick={() => handleClick(item.id)}>
                <DeleteIcon />
              </IconButton>
            </Paper>
          ))}
        </Grid>
      </Grid>
    </Box>
  )
}

export default ListVulnerabilityScreen